<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    /> -->
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Arizonia&display=swap"
      rel="stylesheet"
    />

    <!-- Mapbox -->
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css"
      rel="stylesheet"
    />

    <!-- My CSS -->
    <link rel="stylesheet" href="./css/weather-map.css" />

    <title>Document</title>
  </head>
  <body>
    <div class="pagewrapper">
      <div class="container-header">
        <h1>Weather Map API</h1>
      </div>
      <div id="hidden"></div>

      <div class="container-content">
        <div class="container-search">
          <form class="form" method="GET">
            <label for="search" class="search">Pionts Of Interest</label>
            <input type="text" id="search" name="search" />
            <input
              id="btn"
              type="submit"
              value="Submit"
              style="font-family: Arizonia, cursive"
            />
          </form>
        </div>
        <div id="container-cards" class="container-cards">
          <!-- <div class="cards card1">
            <div class="temp">85&deg;F</div>
            <div class="description">Partly cloudyF</div>
            <div class="humidity">87.48&#37;</div>
            <div class="wind">14mph</div>
            <div class="pressure">29.81 inHg</div>
          </div>
          <div class="cards card2">
            <div class="temp">85&deg;F</div>
            <div class="description">Partly cloudyF</div>
            <div class="humidity">87.48&#37;</div>
            <div class="wind">14mph</div>
            <div class="pressure">29.81 inHg</div>
          </div>
          <div class="cards card1">
            <div class="temp">85&deg;F</div>
            <div class="description">Partly cloudyF</div>
            <div class="humidity">87.48&#37;</div>
            <div class="wind">14mph</div>
            <div class="pressure">29.81 inHg</div>
          </div>
          <div class="cards card1">
            <div class="temp">85&deg;F</div>
            <div class="description">Partly cloudyF</div>
            <div class="humidity">87.48&#37;</div>
            <div class="wind">14mph</div>
            <div class="pressure">29.81 inHg</div>
          </div>
          <div class="cards card1">
            <div class="temp">85&deg;F</div>
            <div class="description">Partly cloudyF</div>
            <div class="humidity">87.48&#37;</div>
            <div class="wind">14mph</div>
            <div class="pressure">29.81 inHg</div>
          </div> -->
        </div>
        <div id="map"></div>
        <pre id="coordinates" class="coordinates"></pre>
      </div>
    </div>

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <!-- JS-Keys -->
    <script src="./js/key.js"></script>

    <!-- Bootstrap -->
    <!-- <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script> -->

    <!-- Mapbox -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>

    <!-- Mapbox Geocoding -->
    <!-- <script src="./js/mapbox-geocoder-utils.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js"></script> -->

    <script>
      //   const longAndLat = [];

      //   <--- Mapbox
      mapboxgl.accessToken = keys.mapbox;
      const map = new mapboxgl.Map({
        container: "map", // container ID
        style: "mapbox://styles/mapbox/streets-v12", // style URL
        center: [-98.490415, 29.4267], // starting position [lng, lat]
        zoom: 9, // starting zoom
      });

      map.on("load", function () {
        map.resize();
      });
    </script>

    <script>
      "use strict";

      let hidden = document.querySelector("#hidden");

      let array = [];

      let marker = new mapboxgl.Marker();
      marker.remove();

      console.log(array, "on load");

      $("#btn").on("click", function (e) {
        e.preventDefault();
        array = [];
        const longAndLat = [];

        console.log(array, "after button click");

        let city = "";
        marker.remove();

        city = $("#search").val();

        $.get("http://api.openweathermap.org/geo/1.0/direct", {
          q: city,
          limit: 5,
          appid: keys.openWeather,
          // units: "imperial",
        }).done(function (data) {
          const lon = data[0].lon;
          const lat = data[0].lat;
          longAndLat.push(lon);
          longAndLat.push(lat);
          console.log(typeof data[0].lon, "type of data");
          console.log(longAndLat);

          const fly = (array) => {
            map.flyTo({
              // <-- flyto function sets the next restaurant to jump to on click
              center: array,
              duration: 6000,
              essential: true,
            });
          };

          fly(longAndLat);

          marker = new mapboxgl.Marker({
            draggable: true,
          })
            .setLngLat(longAndLat)
            .addTo(map);

          function onDragEnd() {
            // if (array.length === 2) {
            // $.get("https://api.openweathermap.org/data/2.5/forecast", {
            //   lat: array[1],
            //   lon: array[0],
            //   appid: keys.openWeather,
            //   units: "imperial",
            // })
            //   .done(function (data) {
            //     for (let i = 0; i < data.list.length; i += 8) {
            //       console.log(data);
            //     }
            //   })
            //   .fail(function (jqXhr, status, error) {
            //     console.log(jqXhr);
            //     console.log(status);
            //     console.log(error);
            //   });
            // }
            array = [];
            const lngLat = marker.getLngLat();
            // coordinates.style.display = "block";
            // hidden.innerHTML = `Longitude:${lngLat.lng}<br />Latitude:${lngLat.lat}`;
            coordinates.style.display = "block";
            coordinates.innerHTML = `Longitude: ${lngLat.lng}<br />Latitude: ${lngLat.lat}`;
            array.push(lngLat.lng, lngLat.lat);
            console.log(array, "after move");

            let html = "";
            $.get("https://api.openweathermap.org/data/2.5/forecast", {
              lat: array[1],
              lon: array[0],
              appid: keys.openWeather,
              units: "imperial",
            })
              .done(function (data) {
                let weather = "";
                for (let i = 0; i < data.list.length; i += 8) {
                  if (
                    data.list[i].weather[0].id >= 503 &&
                    data.list[i].weather[0].id <= 531
                  ) {
                    weather = "rain";
                  } else if (
                    data.list[i].weather[0].id >= 600 &&
                    data.list[i].weather[0].id <= 622
                  ) {
                    weather = "snow";
                  } else if (data.list[i].weather[0].id < 502) {
                    weather = "light-rain-502";
                  } else if (data.list[i].weather[0].id === 800) {
                    weather = "clear-800";
                  } else if (data.list[i].weather[0].id === 804) {
                    weather = "overcast-2-804";
                  } else {
                    weather = "blank";
                  }
                  html += `<div class="cards card1 ${weather}">
                <div class="temp">${data.list[i].main.temp}&deg;F</div>
            <div class="humidity">${data.list[i].main.humidity}&#37;</div>
            <div class="pressure">${data.list[i].main.pressure} inHg</div>
            <div class="wind">${data.list[i].wind.speed}mph</div>
            <div class="description ">${data.list[i].weather[0].description}</div>
                    </div>`;

                  //   console.log(data.list[i]);
                  console.log(weather);
                  console.log(data.list[i].weather[0].id);
                  console.log(data.list[i].weather[0].description);
                }
                $("#container-cards").html(html);
              })
              .fail(function (jqXhr, status, error) {
                console.log(jqXhr);
                console.log(status);
                console.log(error);
              });
          }

          marker.on("dragend", onDragEnd);
          console.log();

          //   marker.setLngLat(longAndLat).addTo(map);
          //   marker.setLngLat(longAndLat).addTo(map);
        });

        $("#search").click(function () {
          $("#search").val("");
        });

        /*
      let marker = new mapboxgl.Marker();

      // Submit search value to weatherAPI
      $("#btn").on("click", function (e) {
        e.preventDefault();
        const longAndLat = [];

        let city = "";

        city = $("#search").val();

        $.get("http://api.openweathermap.org/geo/1.0/direct", {
          q: city,
          limit: 5,
          appid: keys.openWeather,
          // units: "imperial",
        }).done(function (data) {
          const lon = data[0].lon;
          const lat = data[0].lat;
          longAndLat.push(lon);
          longAndLat.push(lat);
          console.log(typeof data[0].lon, "type of data");
          console.log(longAndLat);

          const fly = (array) => {
            map.flyTo({
              // <-- flyto function sets the next restaurant to jump to on click
              center: array,
              duration: 12000,
              essential: true,
            });
          };

          fly(longAndLat);

          //   marker.setLngLat(longAndLat).addTo(map);
          marker.setLngLat(longAndLat).addTo(map);
        });

        */
        let html = "";

        $.get(
          "https://api.openweathermap.org/data/2.5/forecast?q=" +
            city +
            "&appid=" +
            keys.openWeather +
            "",
          {
            units: "imperial",
          }
        )
          .done(function (data) {
            // lhtml = "";
            let weather = "";
            for (let i = 0; i < data.list.length; i += 8) {
              if (
                data.list[i].weather[0].id >= 503 &&
                data.list[i].weather[0].id <= 531
              ) {
                weather = "rain";
              } else if (data.list[i].weather[0].id < 502) {
                weather = "light-rain-502";
              } else if (data.list[i].weather[0].id === 800) {
                weather = "clear-800";
              } else if (data.list[i].weather[0].id === 804) {
                weather = "overcast-2-804";
              } else {
                weather = "blank";
              }
              html += `<div class="cards card1 ${weather}">
                <div class="temp">${data.list[i].main.temp}&deg;F</div>
            <div class="humidity">${data.list[i].main.humidity}&#37;</div>
            <div class="pressure">${data.list[i].main.pressure} inHg</div>
            <div class="wind">${data.list[i].wind.speed}mph</div>
            <div class="description ">${data.list[i].weather[0].description}</div>
                    </div>`;

              //   console.log(data.list[i]);
              console.log(weather);
              console.log(data.list[i].weather[0].id);
              console.log(data.list[i].weather[0].description);
            }
            $("#container-cards").html(html);
          })
          .fail(function (jqXhr, status, error) {
            console.log(jqXhr);
            console.log(status);
            console.log(error);
          });

        //   $.get("https://api.openweathermap.org/data/2.5/forecast", {
        //     lat: longAndLat[1],
        //     lon: longAndLat[0],
        //     appid: keys.openWeather,
        //     units: "imperial",
        //   })
        //     .done(function (data) {
        //       for (let i = 0; i < data.list.length; i += 8) {
        //         console.log(data);
        //       }
        //     })
        //     .fail(function (jqXhr, status, error) {
        //       console.log(jqXhr);
        //       console.log(status);
        //       console.log(error);
        //     });
      });
    </script>
  </body>
</html>
