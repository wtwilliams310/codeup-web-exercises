<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Mapbox CDN -->
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css' rel='stylesheet' />

	<link rel='stylesheet'
		href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css'
		type='text/css' />

	<!-- My CSS -->
	<link rel="stylesheet" href="./css/maps-style.css">

	<title>Mapbox Maps</title>


</head>

<body>
	<main class="page-wrapper">
		<div class="container-header">
			<h1>Mapbox API Exercises</h1>
		</div>
		<div class="container-content">
			<section class="row-content">
				<div class="column-map">
					<div id='map'></div>
					<button id="btn" type="button">Recommendations</button>
				</div>
				<div class="column-description">
					<div class="restaurant visible hidden">
						<!-- <h2>THAI BURI</h2> -->
						<p>
							<strong>Thai Buri</strong> offers a taste of the Southeast Asian culinary powerhouse's
							regional cuisine. Using organic products and locally sourced ingredients, every dish
							is freshly prepared.
						</p>
						<div class="image">
							<img src="./img/thai-1.jpg" alt="">
						</div>
					</div>
					<div id="description"></div>
				</div>
			</section>
		</div>
	</main>



	<!-- JS-Keys -->
	<script src="./js/key.js"></script>

	<!-- Mapbox -->
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js'></script>

	<!-- Mapbox Geocoding -->
	<script src="./js/mapbox-geocoder-utils.js"></script>
	<script
		src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js'></script>

	<!-- Restaurnat Object -->
	<script>
		const restaurants = [
			{
				geoLocation: [-98.51201, 29.60665],
				name: "<strong>Thai Buri</strong>",
				description: "<p><strong>Thai Buri</strong> offers a taste of the Southeast Asian culinary powerhouse's regional cuisine. Using orgainc products and locally sourced ingredients, every dish is freshly prepared. 12:00-6:00 p.m.</p>",
				image: '<img src="./img/thai-1.jpg" alt="">'
			},
			{
				geoLocation: [-98.490415, 29.4267],
				name: "<strong>Bohanan's</strong>",
				description: "<p><strong>Bohanan's</strong> is located in the heart of San Antonio on historic Houston Street, Bohanan's beautiful upstairs dining room has an Old-World steakhouse charm with a modern attention to detail.</p>",
				image: '<img src="./img/thai-1.jpg" alt="">'
			},
			{
				geoLocation: [-98.522642, 29.534725],
				name: "<strong>Azro</strong>",
				description: "<p><strong>Azro</strong> is a family operated Authentic Afghan cuisine established in 2014. Azro is based off of recipes past down from generations incorporating spices including cardamom, cinnamon, cloves, coriander and more.</p>",
				image: '<img src="./img/thai-1.jpg" alt="">'
			}
		];
	</script>

	<!-- Custom JS -->
	<script>
		const btn = document.querySelector("#btn")

		const start = {
			center: [-98.51201, 29.60665],
			zoom: 1,
			pitch: 0,
			bearing: 0
		};

		const click1 = {
			center: restaurants[1].geoLocation,
			zoom: 16,
			bearing: 0,
			pitch: 45
		};

		const click2 = {
			center: restaurants[0].geoLocation,
			zoom: 18,
			bearing: 180,
			pitch: 30
		};

		const click3 = {
			center: restaurants[2].geoLocation,
			zoom: 17,
			bearing: 0,
			pitch: 30
		};


		mapboxgl.accessToken = keys.mapbox;
		const map = new mapboxgl.Map({
			container: 'map', // container ID
			// style: 'mapbox://styles/mapbox/streets-v12', // style URL
			// style: 'mapbox://styles/wtwilliams310/cld6g5rm4006g01p52e0txsyj', // 3D building style URL
			style: 'mapbox://styles/mapbox/satellite-streets-v12', // Satellite style URL
			...start,
			zoom: 1, // starting zoom
		});


		const geocoder = new MapboxGeocoder({
			// Initialize the geocoder
			accessToken: keys.mapbox, // Set the access token
			mapboxgl: mapboxgl, // Set the mapbox-gl instance
			marker: true // Set to false to not use the default marker style
		});

		// <---------- Set marker

		// <---------- Set Pop-up

		// <---------- Add the geocoder to the map
		map.addControl(geocoder);

		// Geocode helper function
		// Thai Buri
		// geocode("2211 NW Military Hwy #131, San Antonio, TX 78213", keys.mapbox).then(function (result) {
		// 	console.log(result);
		// 	map.setCenter(result);
		// 	map.setZoom(15);

		// <---------- Place marker at result ----------------->
		map.on('load', () => {
			map.addSource('single-point', {
				type: 'geojson',
				data: {
					type: 'FeatureCollection',
					features: []
				}
			});

			map.setFog({
				'horizon-blend': 0.05, // Exaggerate atmosphere (default is .1)
				"range": [0.8, 8],
				"space-color": "#000000",
				"star-intensity": 0.15
			});

			map.addLayer({
				id: 'point',
				source: 'single-point',
				type: 'circle',
				paint: {
					'circle-radius': 10,
					'circle-color': '#448ee4'
				}
			});

			let isAtStart = true;

			// Listen for the `result` event from the Geocoder
			// `result` event is triggered when user makes a selection
			//  Add a marker at the result's coordinates
			// geocoder.on('result', (event) => {
			// 	map.getSource('single-point').setData(event.result.geometry);
			// });


			// <---------- Function to acces restaurants object

			function loadRestaurants(obj) {
				for (let i = 0; i < obj.length; i++) {
					let popup = new mapboxgl.Popup({ offset: 25, closeOnClick: false })
						.setHTML(restaurants[i].name)



					let marker = new mapboxgl.Marker()
						.setLngLat(restaurants[i].geoLocation)
						.setPopup(popup)
						.addTo(map);


				}
			}

			let count = {
				center: "center",
				zoom: 16,
				bearing: 0,
				pitch: 5
			};

			console.log(count.center);

			btn.addEventListener('click', function (e) {

				loadRestaurants(restaurants)

				const fly = (targetRestaurant) => {
					map.flyTo({
						...targetRestaurant,
						duration: 12000,
						essential: true
					});
				}


				console.log(count.center)

				if (count.center === "center") {

					fly(click1)
					// let target = click1
					// map.flyTo({
					// 	...target,
					// 	duration: 12000,
					// 	essential: true
					// });

					count.center = click1;

				} else if (count.center === click1) {
					target = click2;

					map.flyTo({
						...target,
						duration: 12000,
						essential: true
					});

					count.center = click2
				} else {
					target = click3;

					map.flyTo({
						...target,
						duration: 12000,
						essential: true
					});

					count.center = "center";
				}

			})


		});

        //Pop-up













	</script>
</body>

</html>